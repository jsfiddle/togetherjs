(function(){var a,b,c,d,e,f,g,h=!0,i=window.sharejs,j={name:"text-tp2",tp2:!0,create:function(){return{charLength:0,totalLength:0,positionCache:[],data:[]}},serialize:function(a){if(!a.data)throw new Error("invalid doc snapshot");return a.data},deserialize:function(a){var b,c,d,e=j.create();e.data=a;for(c=0,d=a.length;c<d;c++)b=a[c],typeof b=="string"?(e.charLength+=b.length,e.totalLength+=b.length):e.totalLength+=b;return e}},k=function(a){var b,c,d,e,f;if(!Array.isArray(a))throw new Error("Op must be an array of components");c=null,f=[];for(d=0,e=a.length;d<e;d++){b=a[d];if(typeof b=="object")if(b.i!==void 0){if(!(typeof b.i=="string"&&b.i.length>0||typeof b.i=="number"&&b.i>0))throw new Error("Inserts must insert a string or a +ive number")}else{if(b.d===void 0)throw new Error("Operation component must define .i or .d");if(!(typeof b.d=="number"&&b.d>0))throw new Error("Deletes must be a +ive number")}else{if(typeof b!="number")throw new Error("Op components must be objects or numbers");if(!(b>0))throw new Error("Skip components must be a positive number");if(typeof c=="number")throw new Error("Adjacent skip components should be combined")}f.push(c=b)}return f};j._takeDoc=f=function(a,b,c,d){var e,f,g;if(b.index>=a.data.length)throw new Error("Operation goes past the end of the document");return e=a.data[b.index],f=typeof e=="string"?c!==void 0?e.slice(b.offset,b.offset+c):e.slice(b.offset):c===void 0||d?e-b.offset:Math.min(c,e-b.offset),g=f.length||f,(e.length||e)-b.offset>g?b.offset+=g:(b.index++,b.offset=0),f},j._appendDoc=b=function(a,b){var c;if(b===0||b==="")return;typeof b=="string"?(a.charLength+=b.length,a.totalLength+=b.length):a.totalLength+=b,c=a.data,c.length===0?c.push(b):typeof c[c.length-1]==typeof b?c[c.length-1]+=b:c.push(b)},j.apply=function(a,c){var d,e,g,h,i,l,m;if(a.totalLength===void 0||a.charLength===void 0||a.data.length===void 0)throw new Error("Snapshot is invalid");k(c),e=j.create(),h={index:0,offset:0};for(l=0,m=c.length;l<m;l++){d=c[l];if(typeof d=="number"){i=d;while(i>0)g=f(a,h,i),b(e,g),i-=g.length||g}else if(d.i!==void 0)b(e,d.i);else if(d.d!==void 0){i=d.d;while(i>0)g=f(a,h,i),i-=g.length||g;b(e,d.d)}}return e},j._append=a=function(a,b){var c;if(b!==0&&b.i!==""&&b.i!==0&&b.d!==0)return a.length===0?a.push(b):(c=a[a.length-1],typeof b=="number"&&typeof c=="number"?a[a.length-1]+=b:b.i!==void 0&&c.i!=null&&typeof c.i==typeof b.i?c.i+=b.i:b.d!==void 0&&c.d!=null?c.d+=b.d:a.push(b))},e=function(a){var b=0,c=0,d=function(d,e){var f,g,h,i;return b===a.length?null:(h=a[b],typeof (g=h)=="number"||typeof (g=h.i)=="number"||(g=h.d)!==void 0?(d==null||g-c<=d||e&&h.i!==void 0?(f=g-c,++b,c=0):(c+=d,f=d),h.i!==void 0?{i:f}:h.d!==void 0?{d:f}:f):(d==null||h.i.length-c<=d||e?(i={i:h.i.slice(c)},++b,c=0):(i={i:h.i.slice(c,c+d)},c+=d),i))},e=function(){return a[b]};return[d,e]},d=function(a){return typeof a=="number"?a:typeof a.i=="string"?a.i.length:a.d||a.i},j.normalize=function(b){var c,d,e,f=[];for(d=0,e=b.length;d<e;d++)c=b[d],a(f,c);return f},g=function(b,c,f,g){var h,i,j,l,m,n,o,p,q,r;k(b),k(c),l=[],q=e(b),n=q[0],m=q[1];for(o=0,p=c.length;o<p;o++){i=c[o],j=d(i);if(i.i!==void 0)if(f){if(g==="left")while(((r=m())!=null?r.i:void 0)!==void 0)a(l,n());a(l,j)}else while(j>0){h=n(j,!0);if(h===null)throw new Error("The transformed op is invalid");if(h.d!==void 0)throw new Error("The transformed op deletes locally inserted characters - it cannot be purged of the insert.");typeof h=="number"?j-=h:a(l,h)}else while(j>0){h=n(j,!0);if(h===null)throw new Error("The op traverses more elements than the document has");a(l,h),h.i||(j-=d(h))}}while(i=n()){if(i.i===void 0)throw new Error("Remaining fragments in the op: "+i);a(l,i)}return l},j.transform=function(a,b,c){if(c!=="left"&&c!=="right")throw new Error("side ("+c+") should be 'left' or 'right'");return g(a,b,!0,c)},j.prune=function(a,b){return g(a,b,!1)},j.compose=function(b,c){var f,g,h,i,j,l,m,n,o,p;if(b===null||b===void 0)return c;k(b),k(c),j=[],p=e(b),l=p[0],m=p[1];for(n=0,o=c.length;n<o;n++){h=c[n];if(typeof h=="number"){i=h;while(i>0){f=l(i);if(f===null)throw new Error("The op traverses more elements than the document has");a(j,f),i-=d(f)}}else if(h.i!==void 0)a(j,{i:h.i});else{i=h.d;while(i>0){f=l(i);if(f===null)throw new Error("The op traverses more elements than the document has");g=d(f),f.i!==void 0?a(j,{i:g}):a(j,{d:g}),i-=g}}}while(h=l()){if(h.i===void 0)throw new Error("Remaining fragments in op1: "+h);a(j,h)}return j},typeof h!="undefined"&&h!==null?i.types["text-tp2"]=j:module.exports=j,typeof h!="undefined"&&h!==null?j=i.types["text-tp2"]:j=require("./text-tp2"),f=j._takeDoc,a=j._append,c=function(b,c,d,e){var g,h=[];while((e===void 0||e>0)&&d.index<c.data.length)g=f(c,d,e,!0),e!==void 0&&typeof g=="string"&&(e-=g.length),h.push(a(b,g.length||g));return h},j.api={provides:{text:!0},getLength:function(){return this.snapshot.charLength},getText:function(){var a,b=function(){var b,c,d=this.snapshot.data,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],typeof a=="string"&&e.push(a);return e}.call(this);return b.join("")},insert:function(b,d,e){var f,g;return d===void 0&&(d=0),g=[],f={index:0,offset:0},c(g,this.snapshot,f,d),a(g,{i:b}),c(g,this.snapshot,f),this.submitOp(g,e),g},del:function(b,d,e){var g,h=[],i={index:0,offset:0};c(h,this.snapshot,i,d);while(b>0)g=f(this.snapshot,i,b,!0),typeof g=="string"?(a(h,{d:g.length}),b-=g.length):a(h,g);return c(h,this.snapshot,i),this.submitOp(h,e),h},_register:function(){return this.on("remoteop",function(a,b){var c,d,e,g,h,i=0,j={index:0,offset:0};for(g=0,h=a.length;g<h;g++){c=a[g];if(typeof c=="number"){e=c;while(e>0)d=f(b,j,e),typeof d=="string"&&(i+=d.length),e-=d.length||d}else if(c.i!==void 0)typeof c.i=="string"&&(this.emit("insert",c.i,i),i+=c.i.length);else{e=c.d;while(e>0)d=f(b,j,e),typeof d=="string"&&this.emit("delete",d,i),e-=d.length||d}}})}}}).call(this)